<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Immo data visualizer</title>
  <script src="https://cdn.plot.ly/plotly-2.12.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js" integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="database.js"></script>
</head>
<body>
<h2>Bayreuth</h2>
<div id="countOfEstates" style="width:600px;height:350px;"></div>
<div id="avgPrice" style="width:600px;height:350px;"></div>
<div id="avgPricePerSquareMetre" style="width:600px;height:350px;"></div>
<div id="addedEstatesPerDay" style="width:600px;height:350px;"></div>

<script>
    let datesAsArray = Object.keys(data)

    Plotly.newPlot("countOfEstates", [{
        x: datesAsArray,
        y: Object.entries(data).map(x => x[1].length)
    }], {
        title: "Anzahl der verfügbaren Immobilien"
    });

    Plotly.newPlot("avgPrice", [{
        x: datesAsArray,
        y: Object.entries(data).map(x => _.meanBy(x[1], e => e.price))
    }], {
        title: "Durchschnittspreis",
        yaxis: { title: "€" }
    });

    Plotly.newPlot("avgPricePerSquareMetre", [{
        x: datesAsArray,
        y: Object.entries(data).map(x => _.meanBy(x[1], e => e.area ? e.price/ e.area : undefined)),
    }], {
        title: "Durchschnittspreis pro m²",
        yaxis: { title: "€/m²" }
    }, );

    const addedEstates = [];
    let estatesOnDayBefore = undefined;
    for(let i of Object.values(data)) {
        addedEstates.push(estatesOnDayBefore ? i.length - estatesOnDayBefore : 0);
        estatesOnDayBefore = i.length;
    }

    Plotly.newPlot("addedEstatesPerDay", [{
        x: datesAsArray,
        y: addedEstates,
        type: "bar",
    }], {
        title: "Änderung zum Vortag",
        yaxis: { title: "" }
    }, );
</script>
</body>
</html>